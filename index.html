<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RedDay ‚Ä¢ –ö–∞–ª–µ–Ω–¥–∞—Ä—å (PoC)</title>
<style>
:root{--bg:#f5f7fa;--card:#fff;--text:#111827;--muted:#6b7280;--border:#e5e7eb;--brand:#3b82f6;--editbg:#eef6ff}
*{box-sizing:border-box}
body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
.container{max-width:980px;margin:0 auto;padding:14px}
.card{background:var(--card);border:1px solid var(--border);border-radius:12px;box-shadow:0 1px 2px rgba(0,0,0,.05)}
.topbar{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--border);border-radius:12px 12px 0 0}
.title{display:flex;align-items:center;gap:8px;font-weight:800}
.btn{padding:8px 12px;border:1px solid var(--border);border-radius:10px;background:#fff;cursor:pointer;font-weight:600}
.btn.small{padding:6px 9px;font-size:12px}
.panel{padding:12px}
.muted{font-size:12px;color:var(--muted)}
.profiles-row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:8px}
.profiles{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.pill{display:flex;align-items:center;gap:6px;padding:5px 10px;border:1px solid var(--border);border-radius:999px;background:#fff}
.pill.active{border-color:var(--brand);box-shadow:0 0 0 2px #3b82f622 inset}
.pill input{padding:4px 8px;border:1px solid var(--border);border-radius:8px;min-width:140px}
.dot{width:10px;height:10px;border-radius:999px;border:1px solid #0001}
.icon{margin-left:6px;font-size:12px;cursor:pointer;opacity:.7;user-select:none}
.icon:hover{opacity:1}
.info{display:grid;grid-template-columns:repeat(4,1fr);gap:8px;margin-bottom:8px}
.ibox{padding:10px;border:1px solid var(--border);border-radius:10px;background:#fafafa;text-align:center}
.ibox b{display:block;color:var(--muted);font-size:12px}
.ibox .big{font-weight:800}
.mode-row{display:flex;gap:8px;align-items:center;justify-content:space-between;margin:8px 0}
.mode-banner{flex:1;border:1px dashed #bfdbfe;background:var(--editbg);padding:12px;border-radius:10px;text-align:center;font-weight:800;font-size:16px}
.cal-head{display:flex;align-items:center;justify-content:space-between;padding:8px 0}
.cal-wrap{padding:6px;border-radius:10px;transition:background .2s ease}
.grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
.dow{font-size:11px;color:var(--muted);text-align:center;padding-bottom:6px}
.day{position:relative;min-height:84px;padding:6px;border:1px solid var(--border);border-radius:10px;background:#fff;cursor:default}
.day.out{background:#fafafa;color:var(--muted)}
.num{font-weight:800;font-size:12px}
.menses{position:absolute;left:2px;right:2px;bottom:26px;height:10px;border-radius:6px;border:1px solid currentColor}
.pms{position:absolute;left:2px;right:2px;bottom:12px;height:8px;border-radius:6px;background:#9ca3af;opacity:.15}
.ov{position:absolute;left:6px;bottom:6px}
.prob{position:absolute;left:2px;right:2px;bottom:2px;height:6px;border-radius:6px}
.legend{display:flex;gap:12px;align-items:center;color:var(--muted);font-size:12px;padding-top:6px}
.legend .box{width:16px;height:10px;border-radius:4px;border:1px solid var(--border);display:inline-block;margin-right:4px}
.editing .day{cursor:pointer;background:var(--editbg)}
.editing .cal-wrap{background:var(--editbg)}
.tabs{display:flex;gap:8px;align-items:center}
.tab{padding:6px 10px;border:1px solid var(--border);border-radius:10px;cursor:pointer;background:#fff}
.tab.active{background:var(--brand);border-color:var(--brand);color:#fff}
@media(max-width:760px){.container{padding:8px}.info{grid-template-columns:1fr 1fr}.profiles-row{flex-direction:column;align-items:flex-start}.mode-row{flex-direction:column;align-items:stretch}.grid{gap:4px}.day{min-height:64px}.title h1{font-size:16px}}
@media(max-width:420px){.pill input{min-width:120px}.info{grid-template-columns:1fr}.day{min-height:56px;padding:4px}.num{font-size:11px}}
.lock{position:fixed;inset:0;background:rgba(0,0,0,.3);display:none;align-items:center;justify-content:center;z-index:40}
.lock .box{background:#fff;border:1px solid var(--border);border-radius:12px;padding:16px;min-width:300px}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:8px}
</style>
</head>
<body>
<div class="container">
  <div class="card">
    <div class="topbar">
      <div class="title"><span id="appIcon" style="font-size:20px">üìÖ</span><h1 id="appName" style="margin:0;font-size:18px">RedDay</h1></div>
      <div class="tabs"><div class="tab active" data-tab="cal">–ö–∞–ª–µ–Ω–¥–∞—Ä—å</div><div class="tab" data-tab="sum">–°–≤–æ–¥–∫–∞</div><div class="tab" data-tab="set">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</div></div>
    </div>
    <div class="panel" id="tabCal" style="display:block">
      <div class="profiles-row">
        <div id="profiles" class="profiles"></div>
        <div><button class="btn small" id="btnAdd">+ –ü—Ä–æ—Ñ–∏–ª—å</button></div>
      </div>
      <div class="info">
        <div class="ibox"><b>–ü—Ä–æ—Ñ–∏–ª—å</b><div class="big" id="hdrProfile">‚Äî</div></div>
        <div class="ibox"><b>–ù–∞—á–∞–ª–æ –º–µ—Å.</b><div class="big" id="hdrStart">‚Äî</div></div>
        <div class="ibox"><b>–û–≤—É–ª—è—Ü–∏—è</b><div class="big" id="hdrOv">‚Äî</div></div>
        <div class="ibox"><b>–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —Å–µ–≥–æ–¥–Ω—è</b><div class="big" id="hdrProb">‚Äî</div></div>
      </div>
      <div class="mode-row">
        <div class="mode-banner" id="modeBanner">–ö–ª–∏–∫–Ω–∏—Ç–µ –≤ –¥–∞—Ç—É –Ω–∞—á–∞–ª–∞ –º–µ—Å—è—á–Ω—ã—Ö</div>
        <button class="btn" id="btnMode" style="display:none">–£–∫–∞–∑–∞—Ç—å –º–µ—Å—è—á–Ω—ã–µ</button>
      </div>
      <div class="cal-head">
        <div style="display:flex;gap:6px;align-items:center">
          <button class="btn small" id="prev">‚óÄ</button>
          <h3 id="month" style="margin:0"></h3>
          <button class="btn small" id="next">‚ñ∂</button>
        </div>
        <div class="legend">
          <span><span class="box" style="background:#ef444422;border:1px solid #ef4444"></span>–ú–µ—Å—è—á–Ω—ã–µ</span>
          <span><span class="box" style="background:#9ca3af33"></span>–ü–ú–°</span>
          <span>‚óØ –û–≤—É–ª—è—Ü–∏—è</span>
          <span><span class="box" style="background:#d1d5db"></span>–ù–∏–∑–∫.</span>
          <span><span class="box" style="background:#f59e0b"></span>–°—Ä–µ–¥–Ω.</span>
          <span><span class="box" style="background:#ef4444"></span>–í—ã—Å.</span>
        </div>
      </div>
      <div class="cal-wrap" id="calWrap">
        <div class="grid" id="dow"></div>
        <div class="grid" id="grid"></div>
      </div>
    </div>
    <div class="panel" id="tabSum" style="display:none">
      <div class="cal-head">
        <div style="display:flex;gap:6px;align-items:center">
          <button class="btn small" id="prevS">‚óÄ</button>
          <h3 id="monthS" style="margin:0"></h3>
          <button class="btn small" id="nextS">‚ñ∂</button>
        </div>
        <div class="muted">–í—Å–µ –ø—Ä–æ—Ñ–∏–ª–∏</div>
      </div>
      <div class="cal-wrap">
        <div class="grid" id="dowS"></div>
        <div class="grid" id="gridS"></div>
      </div>
    </div>
    <div class="panel" id="tabSet" style="display:none">
      <div class="row"><label>–ù–∞–∑–≤–∞–Ω–∏–µ</label><input id="setName" type="text" style="padding:8px;border:1px solid var(--border);border-radius:8px" value="RedDay"></div>
      <div class="row"><label>–ò–∫–æ–Ω–∫–∞</label><select id="setIcon" style="padding:8px;border:1px solid var(--border);border-radius:8px"><option>üìÖ</option><option>üìÜ</option><option>üóìÔ∏è</option><option>üìò</option><option>‚úÖ</option></select></div>
      <div class="row"><label>–ü–∞—Ä–æ–ª—å (PoC)</label><input id="setPass" type="password" placeholder="–Ω–µ –æ–±—è–∑–∞—Ç." style="padding:8px;border:1px solid var(--border);border-radius:8px"></div>
      <div class="row"><button class="btn" id="btnSaveSet">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button><span class="muted">–î–µ–º–æ: –¥–∞–Ω–Ω—ã–µ –≤ localStorage</span></div>
    </div>
  </div>
</div>
<div class="lock" id="lock"><div class="box"><div><b>RedDay –∑–∞—â–∏—â—ë–Ω –ø–∞—Ä–æ–ª–µ–º</b></div><div class="row"><input id="lockInp" type="password" placeholder="–ü–∞—Ä–æ–ª—å" style="padding:8px;border:1px solid var(--border);border-radius:8px;flex:1"></div><div class="row" style="justify-content:flex-end"><button class="btn" id="lockBtn">–í–æ–π—Ç–∏</button></div><div class="muted">PoC: –ª–æ–∫–∞–ª—å–Ω–∞—è –∏–º–∏—Ç–∞—Ü–∏—è</div></div></div>
<script>
const $=q=>document.querySelector(q), $$=q=>Array.from(document.querySelectorAll(q));
const fmtMonth=d=>{const s=new Intl.DateTimeFormat('ru-RU',{month:'long',year:'numeric'}).format(d);return s[0].toUpperCase()+s.slice(1)};
const fmtDate=d=>new Intl.DateTimeFormat('ru-RU',{day:'2-digit',month:'long'}).format(d);
const fmtISO=d=>{const y=d.getFullYear(),m=String(d.getMonth()+1).padStart(2,'0'),day=String(d.getDate()).padStart(2,'0');return `${y}-${m}-${day}`};
const parseISO=s=>{const[a,b,c]=s.split('-').map(Number);return new Date(a,b-1,c)};
const addDays=(d,n)=>{const x=new Date(d);x.setDate(x.getDate()+n);return x};
const diffDays=(a,b)=>Math.floor((a-b)/86400000);
const KEY='redday_full_poc_v8';
const COLORS=['#ef4444','#10b981','#3b82f6','#f59e0b','#8b5cf6','#14b8a6','#f97316','#e11d48'];
let app=null,ui={editingId:null};
function load(){try{const r=localStorage.getItem(KEY);return r?JSON.parse(r):null}catch{return null}}
function save(){localStorage.setItem(KEY,JSON.stringify(app))}
function init(){app=load();if(!app){const id='p_'+Math.random().toString(36).slice(2);app={name:'RedDay',icon:'üìÖ',password:'',profiles:[{id,name:'–ù–æ–≤–∞—è –∂–µ–Ω—â–∏–Ω–∞',color:COLORS[0],startISO:null,editMode:true}],activeId:id,monthISO:fmtISO(new Date(new Date().getFullYear(),new Date().getMonth(),1)),monthSISO:fmtISO(new Date(new Date().getFullYear(),new Date().getMonth(),1))};app.profiles[0].id=id;save()}if(!app.activeId||!app.profiles.find(p=>p.id===app.activeId)){app.activeId=app.profiles[0]?.id||null;save()}$('#appName').textContent=app.name||'RedDay';$('#appIcon').textContent=app.icon||'üìÖ';$('#setName').value=app.name||'RedDay';$('#setIcon').value=app.icon||'üìÖ';}
function active(){return app.profiles.find(p=>p.id===app.activeId)||app.profiles[0]}
function setActive(id){app.activeId=id;save();renderAll()}
function nextColor(){const used=app.profiles.map(p=>p.color);for(const c of COLORS) if(!used.includes(c)) return c;return COLORS[(app.profiles.length)%COLORS.length]}
function addProfile(){const p={id:'p_'+Math.random().toString(36).slice(2),name:'–ù–æ–≤–∞—è –∂–µ–Ω—â–∏–Ω–∞',color:nextColor(),startISO:null,editMode:true};app.profiles.push(p);app.activeId=p.id;ui.editingId=p.id;save();renderAll()}
function deleteById(id,idx){app.profiles=app.profiles.filter(x=>x.id!==id);if(app.profiles.length===0){const nid='p_'+Math.random().toString(36).slice(2);app.profiles=[{id:nid,name:'–ù–æ–≤–∞—è –∂–µ–Ω—â–∏–Ω–∞',color:COLORS[0],startISO:null,editMode:true}];app.activeId=nid}else{const prev=Math.max(0,idx-1);app.activeId=app.profiles[prev].id}if(ui.editingId===id)ui.editingId=null;save();renderAll()}
function modelForDate(date, baseStart){const delta=diffDays(date, baseStart);const k=Math.floor(delta/28);const start=addDays(baseStart, k*28);const endM=addDays(start,4);const ov=addDays(endM,9);const nextStart=addDays(start,28);const pmsStart=addDays(nextStart,-7);return{start,endM,ov,nextStart,pmsStart,pmsEnd:addDays(nextStart,-1)}}
function flagsForDate(date, baseStart){if(!baseStart)return{m:false,p:false,o:false,pmsInt:0,prob:'‚Äî'};const m=modelForDate(date, baseStart);const isM=(date>=m.start&&date<=m.endM);const isO=(fmtISO(date)===fmtISO(m.ov));const isP=(date>=m.pmsStart&&date<=m.pmsEnd);let prob='–ù–∏–∑–∫–∞—è';const d5=addDays(m.start,4),d7=addDays(m.start,6);if(date>=addDays(m.ov,-1)&&date<=addDays(m.ov,1))prob='–í—ã—Å–æ–∫–∞—è';else if((date>=d5&&date<=d7)||fmtISO(date)===fmtISO(addDays(m.ov,2)))prob='–°—Ä–µ–¥–Ω—è—è';const daysToNext=diffDays(m.nextStart,date);const pmsInt=isP?Math.max(1,Math.min(7,8-daysToNext)):0;return{m:isM,p:isP,o:isO,pmsInt,prob,model:m}}
function renderProfiles(){const bar=$('#profiles');bar.innerHTML='';const canDel=app.profiles.length>1;app.profiles.forEach((p,idx)=>{const pill=document.createElement('div');pill.className='pill'+(p.id===app.activeId?' active':'');const dot=document.createElement('span');dot.className='dot';dot.style.background=p.color;pill.appendChild(dot);if(ui.editingId===p.id){const input=document.createElement('input');input.type='text';input.value=p.name||'–ù–æ–≤–∞—è –∂–µ–Ω—â–∏–Ω–∞';pill.appendChild(input);const col=document.createElement('input');col.type='color';col.value=p.color;pill.appendChild(col);setTimeout(()=>{input.focus();input.select();},0);const ok=document.createElement('span');ok.className='icon';ok.textContent='‚úì';ok.onclick=e=>{e.stopPropagation();p.name=(input.value.trim()||'–ù–æ–≤–∞—è –∂–µ–Ω—â–∏–Ω–∞');p.color=col.value||p.color;ui.editingId=null;save();renderAll()};pill.appendChild(ok);const cancel=document.createElement('span');cancel.className='icon';cancel.textContent='‚úñ';cancel.onclick=e=>{e.stopPropagation();ui.editingId=null;renderProfiles()};pill.appendChild(cancel);input.onkeydown=e=>{if(e.key==='Enter')ok.onclick(e);if(e.key==='Escape')cancel.onclick(e)};}else{const name=document.createElement('span');name.textContent=p.name||'–ù–æ–≤–∞—è –∂–µ–Ω—â–∏–Ω–∞';pill.appendChild(name);const edit=document.createElement('span');edit.className='icon';edit.textContent='‚úé';edit.onclick=e=>{e.stopPropagation();ui.editingId=p.id;renderProfiles()};pill.appendChild(edit);if(canDel){const del=document.createElement('span');del.className='icon';del.textContent='üóë';del.onclick=e=>{e.stopPropagation();deleteById(p.id,idx)};pill.appendChild(del)}pill.onclick=()=>setActive(p.id)}bar.appendChild(pill)});}
function renderDOW(el){el.innerHTML='';['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–í—Å'].forEach(t=>{const d=document.createElement('div');d.className='dow';d.textContent=t;el.appendChild(d)})}
function renderCal(){const p=active();const hasStart=!!p.startISO;document.body.classList.toggle('editing',!!p.editMode);$('#modeBanner').style.display=p.editMode?'block':'none';$('#btnMode').style.display=p.editMode?'none':'inline-block';$('#hdrProfile').textContent=p.name||'–ù–æ–≤–∞—è –∂–µ–Ω—â–∏–Ω–∞';const month=parseISO(app.monthISO);$('#month').textContent=fmtMonth(month);const baseStart=hasStart?parseISO(p.startISO):null;const today=new Date();const todayFlags=flagsForDate(today, baseStart);$('#hdrProb').textContent=hasStart?todayFlags.prob:'‚Äî';const headerModel=hasStart?modelForDate(new Date(month.getFullYear(),month.getMonth(),1), baseStart):null;$('#hdrStart').textContent=headerModel?fmtDate(headerModel.start):'‚Äî';$('#hdrOv').textContent=headerModel?fmtDate(headerModel.ov):'‚Äî';const grid=$('#grid'),dow=$('#dow');renderDOW(dow);grid.innerHTML='';const first=new Date(month.getFullYear(),month.getMonth(),1);const startIdx=(first.getDay()+6)%7;const dim=new Date(month.getFullYear(),month.getMonth()+1,0).getDate();const cells=[];for(let i=0;i<startIdx;i++)cells.push({date:addDays(first,i-startIdx),out:true});for(let d=1;d<=dim;d++)cells.push({date:new Date(month.getFullYear(),month.getMonth(),d),out:false});const rem=cells.length%7;if(rem!==0){const extra=7-rem;for(let i=1;i<=extra;i++)cells.push({date:new Date(month.getFullYear(),month.getMonth(),dim+i),out:true})}cells.forEach(c=>{const el=document.createElement('div');el.className='day'+(c.out?' out':'');const num=document.createElement('div');num.className='num';num.textContent=c.date.getDate();el.appendChild(num);const f=flagsForDate(c.date, baseStart);if(f.m){const b=document.createElement('div');b.className='menses';b.style.color=p.color;b.style.background=p.color+'22';el.appendChild(b)}if(f.p){const pm=document.createElement('div');pm.className='pms';pm.style.opacity=(0.06+f.pmsInt*0.05).toFixed(2);el.appendChild(pm)}if(f.o){const ov=document.createElement('div');ov.className='ov';ov.style.color=p.color;ov.textContent='‚óØ';el.appendChild(ov)}if(hasStart){const pr=document.createElement('div');pr.className='prob';pr.style.background=f.prob==='–í—ã—Å–æ–∫–∞—è'? '#ef4444' : (f.prob==='–°—Ä–µ–¥–Ω—è—è'? '#f59e0b' : '#d1d5db');el.appendChild(pr)}el.onclick=()=>{if(!p.editMode)return;p.startISO=fmtISO(c.date);p.editMode=false;save();renderAll()};grid.appendChild(el)});}
function renderSum(){const month=parseISO(app.monthSISO);$('#monthS').textContent=fmtMonth(month);const grid=$('#gridS'),dow=$('#dowS');renderDOW(dow);grid.innerHTML='';const first=new Date(month.getFullYear(),month.getMonth(),1);const startIdx=(first.getDay()+6)%7;const dim=new Date(month.getFullYear(),month.getMonth()+1,0).getDate();const cells=[];for(let i=0;i<startIdx;i++)cells.push({date:addDays(first,i-startIdx),out:true});for(let d=1;d<=dim;d++)cells.push({date:new Date(month.getFullYear(),month.getMonth(),d),out:false});const rem=cells.length%7;if(rem!==0){const extra=7-rem;for(let i=1;i<=extra;i++)cells.push({date:new Date(month.getFullYear(),month.getMonth(),dim+i),out:true})}cells.forEach(c=>{const el=document.createElement('div');el.className='day'+(c.out?' out':'');const num=document.createElement('div');num.className='num';num.textContent=c.date.getDate();el.appendChild(num);let row=0;app.profiles.forEach(p=>{if(!p.startISO)return;const f=flagsForDate(c.date, parseISO(p.startISO));if(f.m){const b=document.createElement('div');b.style.position='absolute';b.style.left='2px';b.style.right='2px';b.style.bottom=(26+row*7)+'px';b.style.height='7px';b.style.borderRadius='6px';b.style.background=p.color+'33';b.style.border='1px solid '+p.color;el.appendChild(b);row++}if(f.o){const ov=document.createElement('div');ov.className='ov';ov.style.color=p.color;ov.style.bottom=(6+row*10)+'px';ov.textContent='‚óØ';el.appendChild(ov)}if(f.p){const pm=document.createElement('div');pm.className='pms';pm.style.opacity=(0.06+f.pmsInt*0.05).toFixed(2);el.appendChild(pm)}});grid.appendChild(el)});
}
function renderTabs(){$$('.tab').forEach(t=>t.onclick=()=>{$$('.tab').forEach(x=>x.classList.remove('active'));t.classList.add('active');$('#tabCal').style.display=t.dataset.tab==='cal'?'block':'none';$('#tabSum').style.display=t.dataset.tab==='sum'?'block':'none';$('#tabSet').style.display=t.dataset.tab==='set'?'block':'none'})}
function renderAll(){renderProfiles();renderCal();renderSum()}
$('#prev').onclick=()=>{const month=parseISO(app.monthISO);app.monthISO=fmtISO(new Date(month.getFullYear(),month.getMonth()-1,1));save();renderCal()}
$('#next').onclick=()=>{const month=parseISO(app.monthISO);app.monthISO=fmtISO(new Date(month.getFullYear(),month.getMonth()+1,1));save();renderCal()}
$('#prevS').onclick=()=>{const month=parseISO(app.monthSISO);app.monthSISO=fmtISO(new Date(month.getFullYear(),month.getMonth()-1,1));save();renderSum()}
$('#nextS').onclick=()=>{const month=parseISO(app.monthSISO);app.monthSISO=fmtISO(new Date(month.getFullYear(),month.getMonth()+1,1));save();renderSum()}
$('#btnAdd').onclick=addProfile
$('#btnMode').onclick=()=>{const p=active();p.editMode=true;save();renderAll()}
$('#btnSaveSet').onclick=()=>{app.name=$('#setName').value||'RedDay';app.icon=$('#setIcon').value;app.password=$('#setPass').value||'';save();$('#appName').textContent=app.name;$('#appIcon').textContent=app.icon;alert('–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ (PoC)')}
renderTabs();
init();
function lockCheck(){if(app.password&&sessionStorage.getItem(KEY+':unlocked')!=='1'){const l=$('#lock');l.style.display='flex';$('#lockBtn').onclick=()=>{if($('#lockInp').value===app.password){sessionStorage.setItem(KEY+':unlocked','1');l.style.display='none'}}}}
lockCheck();
renderAll();
</script>
</body>
</html>
