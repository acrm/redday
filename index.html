<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>RedDay ‚Ä¢ –ö–∞–ª–µ–Ω–¥–∞—Ä—å (PoC)</title>
<style>
  :root{--bg:#f5f7fa;--card:#fff;--text:#111827;--muted:#6b7280;--border:#e5e7eb;--brand:#3b82f6;--menses:#ef4444;--pms:#9ca3af;--ov:#111827;--editbg:#eef6ff}
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
  .container{max-width:980px;margin:0 auto;padding:14px}
  .card{background:var(--card);border:1px solid var(--border);border-radius:12px;box-shadow:0 1px 2px rgba(0,0,0,.05)}
  .topbar{display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--border);border-radius:12px 12px 0 0}
  .title{display:flex;align-items:center;gap:8px;font-weight:800}
  .btn{padding:8px 12px;border:1px solid var(--border);border-radius:10px;background:#fff;cursor:pointer;font-weight:600}
  .btn.small{padding:6px 9px;font-size:12px}
  .panel{padding:12px}
  .muted{font-size:12px;color:var(--muted)}

  .profiles-row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:space-between;margin-bottom:8px}
  .profiles{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .actions{display:flex;gap:8px;flex-wrap:wrap;align-items:center}
  .pill{display:flex;align-items:center;gap:6px;padding:5px 10px;border:1px solid var(--border);border-radius:999px;background:#fff}
  .pill.active{border-color:var(--brand);box-shadow:0 0 0 2px #3b82f622 inset}
  .pill input{padding:4px 8px;border:1px solid var(--border);border-radius:8px;min-width:140px}
  .icon{margin-left:6px;font-size:12px;cursor:pointer;opacity:.7;user-select:none}
  .icon:hover{opacity:1}

  .info{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:8px}
  .ibox{padding:10px;border:1px solid var(--border);border-radius:10px;background:#fafafa;text-align:center}
  .ibox b{display:block;color:var(--muted);font-size:12px}
  .ibox .big{font-weight:800}

  .mode-row{display:flex;gap:8px;align-items:center;justify-content:space-between;margin:8px 0}

  .cal-head{display:flex;align-items:center;justify-content:space-between;padding:8px 0}
  .cal-wrap{padding:6px;border-radius:10px;transition:background .2s ease}
  .grid{display:grid;grid-template-columns:repeat(7,1fr);gap:6px}
  .dow{font-size:11px;color:var(--muted);text-align:center;padding-bottom:6px}
  .day{position:relative;min-height:84px;padding:6px;border:1px solid var(--border);border-radius:10px;background:#fff;cursor:default}
  .day.out{background:#fafafa;color:var(--muted)}
  .num{font-weight:800;font-size:12px}
  .menses{position:absolute;left:2px;right:2px;bottom:26px;height:10px;border-radius:6px;background:var(--menses);opacity:.2;border:1px solid var(--menses)}
  .pms{position:absolute;left:2px;right:2px;bottom:12px;height:8px;border-radius:6px;background:#9ca3af;opacity:.15}
  .ov{position:absolute;left:6px;bottom:6px;color:var(--ov)}
  .legend{display:flex;gap:12px;align-items:center;color:var(--muted);font-size:12px;padding-top:6px}
  .legend .box{width:16px;height:10px;border-radius:4px;border:1px solid var(--border);display:inline-block;margin-right:4px}

  .editing .day{cursor:pointer;background:var(--editbg)}
  .editing .cal-wrap{background:var(--editbg)}

  @media(max-width:760px){
    .container{padding:8px}
    .info{grid-template-columns:1fr}
    .profiles-row{flex-direction:column;align-items:flex-start}
    .mode-row{flex-direction:column;align-items:flex-start}
    .grid{gap:4px}
    .day{min-height:64px}
    .title h1{font-size:16px}
  }
  @media(max-width:420px){
    .pill input{min-width:120px}
    .day{min-height:56px;padding:4px}
    .num{font-size:11px}
  }
</style>
</head>
<body>
<div class="container">
  <div class="card">
    <div class="topbar">
      <div class="title"><span style="font-size:20px">üìÖ</span><h1 style="margin:0;font-size:18px">RedDay ‚Ä¢ –ö–∞–ª–µ–Ω–¥–∞—Ä—å</h1></div>
    </div>

    <div class="panel">
      <div class="profiles-row">
        <div id="profiles" class="profiles"></div>
        <div class="actions">
          <button class="btn small" id="btnAdd">+ –ü—Ä–æ—Ñ–∏–ª—å</button>
        </div>
      </div>

      <div class="info">
        <div class="ibox"><b>–ü—Ä–æ—Ñ–∏–ª—å</b><div class="big" id="hdrProfile">‚Äî</div></div>
        <div class="ibox"><b>–ù–∞—á–∞–ª–æ –º–µ—Å—è—á–Ω—ã—Ö</b><div class="big" id="hdrStart">‚Äî</div></div>
        <div class="ibox"><b>–û–≤—É–ª—è—Ü–∏—è (–ø—Ä–æ–≥–Ω–æ–∑)</b><div class="big" id="hdrOv">‚Äî</div></div>
      </div>

      <div class="mode-row">
        <button class="btn" id="btnMode">–£–∫–∞–∑–∞—Ç—å –º–µ—Å—è—á–Ω—ã–µ: –≤–∫–ª</button>
        <span class="muted" id="modeText">–ö–ª–∏–∫ –ø–æ –¥–Ω—é –≤ —Ä–µ–∂–∏–º–µ —É–∫–∞–∑–∞–Ω–∏—è ‚Äî —Ñ–∏–∫—Å–∏—Ä—É–µ—Ç —Å—Ç–∞—Ä—Ç –∏ –æ—Ç–∫–ª—é—á–∞–µ—Ç —Ä–µ–∂–∏–º</span>
      </div>

      <div class="cal-head">
        <div style="display:flex;gap:6px;align-items:center">
          <button class="btn small" id="prev">‚óÄ</button>
          <h3 id="month" style="margin:0"></h3>
          <button class="btn small" id="next">‚ñ∂</button>
        </div>
        <div class="legend">
          <span><span class="box" style="background:#ef444422"></span>–ú–µ—Å—è—á–Ω—ã–µ</span>
          <span><span class="box" style="background:#9ca3af33"></span>–ü–ú–°</span>
          <span>‚óØ –û–≤—É–ª—è—Ü–∏—è</span>
        </div>
      </div>

      <div class="cal-wrap" id="calWrap">
        <div class="grid" id="dow"></div>
        <div class="grid" id="grid"></div>
      </div>
    </div>
  </div>
</div>
<script>
const $=q=>document.querySelector(q), $$=q=>Array.from(document.querySelectorAll(q));
const fmtMonth=d=>{const s=new Intl.DateTimeFormat('ru-RU',{month:'long',year:'numeric'}).format(d);return s[0].toUpperCase()+s.slice(1)};
const fmtDate=d=>new Intl.DateTimeFormat('ru-RU',{day:'2-digit',month:'long'}).format(d);
const fmtISO=d=>{const y=d.getFullYear();const m=String(d.getMonth()+1).padStart(2,'0');const day=String(d.getDate()).padStart(2,'0');return `${y}-${m}-${day}`};
const parseISO=s=>{const[a,b,c]=s.split('-').map(Number);return new Date(a,b-1,c)};
const addDays=(d,n)=>{const x=new Date(d);x.setDate(x.getDate()+n);return x};
const diffDays=(a,b)=>Math.round((a-b)/86400000);
const LEN_M=5;const LEN_C=28;const KEY='rd_profiles_simple_v6';
let app=null;let ui={editingId:null};
function loadApp(){try{const r=localStorage.getItem(KEY);return r?JSON.parse(r):null}catch{return null}}
function saveApp(){localStorage.setItem(KEY,JSON.stringify(app))}
function uid(){return'p_'+Math.random().toString(36).slice(2)}
function initApp(){app=loadApp();if(!app){const id=uid();app={profiles:[{id,name:'–ù–æ–≤–∞—è –∂–µ–Ω—â–∏–Ω–∞',startISO:null,editMode:true}],activeId:id,monthISO:fmtISO(new Date(new Date().getFullYear(),new Date().getMonth(),1))};app.profiles[0].id=id;saveApp()}if(!app.activeId||!app.profiles.find(p=>p.id===app.activeId)){app.activeId=app.profiles[0]?.id||null;saveApp()}}
function active(){return app.profiles.find(p=>p.id===app.activeId)||app.profiles[0]}
function setActive(id){app.activeId=id;saveApp();renderAll()}
function addProfile(){const p={id:uid(),name:'–ù–æ–≤–∞—è –∂–µ–Ω—â–∏–Ω–∞',startISO:null,editMode:true};app.profiles.push(p);app.activeId=p.id;saveApp();renderAll()}
function deleteById(id,idx){app.profiles=app.profiles.filter(x=>x.id!==id);if(app.profiles.length===0){const nid=uid();app.profiles=[{id:nid,name:'–ù–æ–≤–∞—è –∂–µ–Ω—â–∏–Ω–∞',startISO:null,editMode:true}];app.activeId=nid}else{const prev=Math.max(0,idx-1);app.activeId=app.profiles[prev].id}if(ui.editingId===id)ui.editingId=null;saveApp();renderAll()}
function computeFromStart(start){if(!start)return null;const endM=addDays(start,LEN_M-1);const ov=addDays(endM,9);const nextStart=addDays(start,LEN_C);const pmsStart=addDays(nextStart,-7);return{start,endM,ov,pmsStart,pmsEnd:addDays(nextStart,-1),nextStart}}
function dayFlags(date,model){if(!model)return{m:false,p:false,o:false,pmsInt:0};const m=(date>=model.start&&date<=model.endM);const o=(fmtISO(date)===fmtISO(model.ov));const p=(date>=model.pmsStart&&date<=model.pmsEnd);const daysToNext=diffDays(model.nextStart,date);const pmsInt=p?Math.max(1,Math.min(7,8-daysToNext)):0;return{m,p,o,pmsInt}}
function renderProfiles(){const bar=$('#profiles');bar.innerHTML='';const canDel=app.profiles.length>1;app.profiles.forEach((p,idx)=>{const pill=document.createElement('div');pill.className='pill'+(p.id===app.activeId?' active':'');if(ui.editingId===p.id){const input=document.createElement('input');input.type='text';input.value=p.name||'–ù–æ–≤–∞—è –∂–µ–Ω—â–∏–Ω–∞';pill.appendChild(input);setTimeout(()=>{input.focus();input.select();},0);const ok=document.createElement('span');ok.className='icon';ok.textContent='‚úì';ok.onclick=e=>{e.stopPropagation();p.name=(input.value.trim()||'–ù–æ–≤–∞—è –∂–µ–Ω—â–∏–Ω–∞');ui.editingId=null;saveApp();renderAll()};pill.appendChild(ok);const cancel=document.createElement('span');cancel.className='icon';cancel.textContent='‚úñ';cancel.onclick=e=>{e.stopPropagation();ui.editingId=null;renderProfiles()};pill.appendChild(cancel);input.onkeydown=e=>{if(e.key==='Enter')ok.onclick(e);if(e.key==='Escape')cancel.onclick(e)};}else{const name=document.createElement('span');name.textContent=p.name||'–ù–æ–≤–∞—è –∂–µ–Ω—â–∏–Ω–∞';pill.appendChild(name);const edit=document.createElement('span');edit.className='icon';edit.textContent='‚úé';edit.onclick=e=>{e.stopPropagation();ui.editingId=p.id;renderProfiles()};pill.appendChild(edit);if(canDel){const del=document.createElement('span');del.className='icon';del.textContent='‚úñ';del.onclick=e=>{e.stopPropagation();deleteById(p.id,idx)};pill.appendChild(del)}pill.onclick=()=>setActive(p.id)}bar.appendChild(pill)});}
function renderDOW(el){el.innerHTML='';['–ü–Ω','–í—Ç','–°—Ä','–ß—Ç','–ü—Ç','–°–±','–í—Å'].forEach(t=>{const d=document.createElement('div');d.className='dow';d.textContent=t;el.appendChild(d)})}
function renderCalendar(){const p=active();document.body.classList.toggle('editing',!!p.editMode);$('#btnMode').textContent='–£–∫–∞–∑–∞—Ç—å –º–µ—Å—è—á–Ω—ã–µ: '+(p.editMode?'–≤–∫–ª':'–≤—ã–∫–ª');const txt=p.editMode?'–†–µ–∂–∏–º ¬´–£–∫–∞–∑–∞—Ç—å –º–µ—Å—è—á–Ω—ã–µ¬ª –≤–∫–ª—é—á–µ–Ω. –ö–ª–∏–∫–Ω–∏—Ç–µ –¥–∞—Ç—É –Ω–∞—á–∞–ª–∞ (5 –¥–Ω–µ–π).':'–ü—Ä–æ—Å–º–æ—Ç—Ä –∫–∞–ª–µ–Ω–¥–∞—Ä—è. –í–∫–ª—é—á–∏—Ç–µ —Ä–µ–∂–∏–º, —á—Ç–æ–±—ã —É–∫–∞–∑–∞—Ç—å –Ω–æ–≤—É—é –¥–∞—Ç—É –Ω–∞—á–∞–ª–∞.';const t=$('#modeText');if(t)t.textContent=txt;$('#hdrProfile').textContent=p.name||'–ù–æ–≤–∞—è –∂–µ–Ω—â–∏–Ω–∞';const start=p.startISO?parseISO(p.startISO):null;const model=start?computeFromStart(start):null;$('#hdrStart').textContent=model?fmtDate(model.start):'‚Äî';$('#hdrOv').textContent=model?fmtDate(model.ov):'‚Äî';const month=app.monthISO?parseISO(app.monthISO):new Date();$('#month').textContent=fmtMonth(month);const grid=$('#grid'),dow=$('#dow');renderDOW(dow);grid.innerHTML='';const first=new Date(month.getFullYear(),month.getMonth(),1);const startIdx=(first.getDay()+6)%7;const dim=new Date(first.getFullYear(),month.getMonth()+1,0).getDate();const cells=[];for(let i=0;i<startIdx;i++)cells.push({date:addDays(first,i-startIdx),out:true});for(let d2=1;d2<=dim;d2++)cells.push({date:new Date(month.getFullYear(),month.getMonth(),d2),out:false});const rem=cells.length%7;if(rem!==0){const extra=7-rem;for(let i=1;i<=extra;i++)cells.push({date:new Date(month.getFullYear(),month.getMonth(),dim+i),out:true})}cells.forEach(c=>{const el=document.createElement('div');el.className='day'+(c.out?' out':'');const num=document.createElement('div');num.className='num';num.textContent=c.date.getDate();el.appendChild(num);const f=dayFlags(c.date,model);if(f.m){const b=document.createElement('div');b.className='menses';el.appendChild(b)}if(f.p){const pm=document.createElement('div');pm.className='pms';pm.style.opacity=(0.06+f.pmsInt*0.05).toFixed(2);el.appendChild(pm)}if(f.o){const ov=document.createElement('div');ov.className='ov';ov.textContent='‚óØ';el.appendChild(ov)}el.onclick=()=>{if(!p.editMode)return;p.startISO=fmtISO(c.date);p.editMode=false;saveApp();renderAll()};grid.appendChild(el)})}
function renderAll(){renderProfiles();renderCalendar()}
$('#prev').onclick=()=>{const month=app.monthISO?parseISO(app.monthISO):new Date();const m=new Date(month.getFullYear(),month.getMonth()-1,1);app.monthISO=fmtISO(m);saveApp();renderCalendar()}
$('#next').onclick=()=>{const month=app.monthISO?parseISO(app.monthISO):new Date();const m=new Date(month.getFullYear(),month.getMonth()+1,1);app.monthISO=fmtISO(m);saveApp();renderCalendar()}
$('#btnAdd').onclick=addProfile
$('#btnMode').onclick=()=>{const p=active();p.editMode=!p.editMode;saveApp();renderAll()}
initApp();
renderAll();
</script>
</body>
</html>
